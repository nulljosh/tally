<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 980 1200" width="980" height="1200">
  <style>
    text { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    .bg { fill: #f5f5f7; }
    .card { fill: #ffffff; stroke: #d2d2d7; stroke-width: 2; rx: 12; }
    .card-auth { fill: #e8f1ff; stroke: #7aaef7; stroke-width: 2; rx: 12; }
    .card-cloud { fill: #fff4e5; stroke: #f5a623; stroke-width: 2; rx: 12; }
    .card-ok { fill: #eaf8ec; stroke: #6ac17a; stroke-width: 2; rx: 12; }
    .title { font-size: 28px; font-weight: 700; fill: #1d1d1f; }
    .label { font-size: 16px; font-weight: 600; fill: #1d1d1f; }
    .sub { font-size: 13px; fill: #6e6e73; }
    .arrow { stroke: #8e8e93; stroke-width: 2; fill: none; }
    .arrow-cloud { stroke: #f5a623; stroke-width: 2; fill: none; }
  </style>

  <rect class="bg" x="0" y="0" width="980" height="1200" rx="16"/>
  <text class="title" x="490" y="52" text-anchor="middle">Tally User and Data Workflow</text>

  <rect class="card-auth" x="320" y="90" width="340" height="72" rx="12"/>
  <text class="label" x="490" y="120" text-anchor="middle">1. Open Root URL</text>
  <text class="sub" x="490" y="142" text-anchor="middle">/ redirects to /login.html</text>

  <rect class="card-auth" x="320" y="195" width="340" height="92" rx="12"/>
  <text class="label" x="490" y="228" text-anchor="middle">2. Login</text>
  <text class="sub" x="490" y="250" text-anchor="middle">POST /api/login validates BC Self-Serve credentials</text>
  <text class="sub" x="490" y="268" text-anchor="middle">session stores hashed userId and encrypted password</text>

  <rect class="card-ok" x="320" y="320" width="340" height="72" rx="12"/>
  <text class="label" x="490" y="350" text-anchor="middle">3. Redirect</text>
  <text class="sub" x="490" y="372" text-anchor="middle">client navigates to /app</text>

  <rect class="card" x="100" y="435" width="340" height="96" rx="12"/>
  <text class="label" x="270" y="468" text-anchor="middle">4A. Check Latest</text>
  <text class="sub" x="270" y="490" text-anchor="middle">GET /api/latest (auth required)</text>
  <text class="sub" x="270" y="508" text-anchor="middle">server returns user-scoped cached data</text>

  <rect class="card" x="540" y="435" width="340" height="96" rx="12"/>
  <text class="label" x="710" y="468" text-anchor="middle">4B. Run Scrape (Local)</text>
  <text class="sub" x="710" y="490" text-anchor="middle">npm run check</text>
  <text class="sub" x="710" y="508" text-anchor="middle">scrapes BC Self-Serve sections</text>

  <rect class="card-cloud" x="540" y="575" width="340" height="96" rx="12"/>
  <text class="label" x="710" y="608" text-anchor="middle">5. Upload Result</text>
  <text class="sub" x="710" y="630" text-anchor="middle">npm run upload-blob</text>
  <text class="sub" x="710" y="648" text-anchor="middle">POST /api/upload with X-User-ID</text>

  <rect class="card-cloud" x="540" y="715" width="340" height="96" rx="12"/>
  <text class="label" x="710" y="748" text-anchor="middle">6. Blob Storage</text>
  <text class="sub" x="710" y="770" text-anchor="middle">tally-cache/&lt;userId&gt;/results.json</text>
  <text class="sub" x="710" y="788" text-anchor="middle">no cross-user cache contamination</text>

  <rect class="card-ok" x="320" y="865" width="340" height="92" rx="12"/>
  <text class="label" x="490" y="898" text-anchor="middle">7. Dashboard Render</text>
  <text class="sub" x="490" y="920" text-anchor="middle">/app shows payment/messages/notifications/requests</text>
  <text class="sub" x="490" y="938" text-anchor="middle">from user-scoped data path</text>

  <path class="arrow" d="M 490 162 L 490 195"/>
  <path class="arrow" d="M 490 287 L 490 320"/>
  <path class="arrow" d="M 490 392 L 490 435"/>
  <path class="arrow" d="M 710 531 L 710 575"/>
  <path class="arrow-cloud" d="M 710 671 L 710 715"/>
  <path class="arrow-cloud" d="M 710 811 L 710 900 L 660 900"/>
  <path class="arrow" d="M 440 483 L 370 483 L 370 865"/>

  <text class="sub" x="490" y="1128" text-anchor="middle">Auth entrypoint is always login page. Dashboard is intentionally separated at /app.</text>
</svg>
